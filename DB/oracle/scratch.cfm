 create or replace procedure proc_objtree_delete ( iNode in int, sScope in varchar2 ) as /* record for source node */ type rNode is record( obt_left int, obt_right int ); rSrc rNode; iMoved int; iLeft int; begin /* get some reference info */ select obt_left, obt_right into rSrc from tbl_objtree where obt_id = iNode; /* get how much to move the left and rights */ case sScope when 'SELF' then iLeft := rSrc.obt_left; iMoved := (rSrc.obt_right - rSrc.obt_left) + 1; when 'DESCENDANTS' then iLeft := rSrc.obt_left + 1; /* don't want to upgrade the node's own left, as it'll still be correct */ iMoved := (rSrc.obt_right - rSrc.obt_left) - 1; end case; /* will (and should!) error if anything else is passed */ /* delete the nodes */ case sScope when 'SELF' then delete from tbl_objtree where obt_left >= rSrc.obt_left and obt_right <= rSrc.obt_right; when 'DESCENDANTS' then delete from tbl_objtree where obt_left > rSrc.obt_left and obt_right < rSrc.obt_right; end case; /* will (and should!) error if anything else is passed */ /* update the left and rights to remove the gap */ proc_objtree_pad(iLeft, 0-iMoved); end; 